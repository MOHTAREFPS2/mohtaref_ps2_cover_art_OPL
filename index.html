<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع محترف PS2 لتحميل وتعديل صور ART الالعاب</title>
    <meta name="description" content="موقع عربي متخصص لتحميل وتعديل أغلفة وأعمال فنية (ART) لألعاب بلايستيشن 2. ابحث بمعرف اللعبة أو قم بتغيير معرفات حزم الصور بسهولة.">
    <meta name="robots" content="index, follow">
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px;
            background-color: #000000; 
            color: #c8c8c8; 
            text-align: center; 
            line-height: 1.7; 
        }
        #page-container {
            width: 100%; 
            max-width: 1200px; 
            margin: 0 auto; 
            background-color: #1a1a1a; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 0 15px rgba(0,0,0,0.5); 
            box-sizing: border-box; 
        }
        h1 {
            color: #33A1FF; 
            margin-bottom: 20px; 
            font-size: clamp(1.8em, 5vw, 2.5em); 
        }
        h1 .highlight-red {
            color: #ff3333; 
        }
        .interface-section {
            text-align: right; 
            margin-top: 25px; 
            margin-bottom: 25px; 
            padding: 15px; 
            background-color: #262626; 
            border-radius: 5px; 
        }
        .interface-section h3 {
            color: #E0E0E0; 
            margin-top: 0; 
            font-size: 1.4em; 
        }
        .interface-section p, .interface-section li, .interface-section label {
            font-size: 1.1em; 
            color: #c8c8c8; 
        }
        .site-description {
             margin-bottom: 25px; /* مسافة بين الروابط والبحث */
        }
        .site-description ul {
            list-style-type: none; 
            padding-right: 0; 
        }
        .site-description li {
            margin-bottom: 5px; 
        }
        .site-description ul ul {
            padding-right: 20px; 
            margin-top: 5px; 
        }
        a {
            color: #5ca9fc; 
            text-decoration: none; 
        }
        a:hover {
            color: #8ec1fa; 
            text-decoration: underline; 
        }
        input[type="text"] {
            padding: 12px; 
            border: 1px solid #444; 
            border-radius: 4px; 
            width: 100%;
            box-sizing: border-box;
            background-color: #333333; 
            color: #ffffff; 
            font-size: 1.05em; 
            margin-bottom: 15px;
        }
        button {
            padding: 12px 25px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            transition: background-color 0.3s; 
            font-size: 1.05em; 
            display: block; 
            margin: 0 auto; 
        }
        button:hover {
            background-color: #0056b3; 
        }
        .status-message {
            margin-top: 20px; 
            min-height: 25px; 
            font-size: 1.15em; 
        }
        .error { color: #ff6666; }
        .loading { color: #f0f0f0; }
        .success { color: #66ff66; }
        .results-area {
            margin-top: 25px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 10px;
        }
        .results-area a.download-link {
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            padding: 10px 15px; 
            background-color: #007bff; 
            color: white; 
            border-radius: 4px; 
            text-decoration: none; 
            font-size: 1.05em; 
        }
        .results-area a.download-link:hover {
            background-color: #0056b3; 
        }
        i.fas, i.fab {
            margin-left: 8px; 
        }
        .id-changer-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 450px;
            margin: 20px auto 0 auto;
        }
        .nav-button {
            margin-top: 20px;
            background-color: #3e8e41; /* لون مختلف لزر التنقل */
        }
        .nav-button:hover {
            background-color: #2e6b31;
        }
    </style>
</head>
<body>
    <div id="page-container">
        <h1><i class="fas fa-gamepad"></i>موقع <span class="highlight-red">محترف PS2</span> لتحميل وتعديل صور ART الالعاب</h1>

        <div class="interface-section" id="search-interface">
            <h3><i class="fas fa-search"></i>واجهة البحث والتحميل</h3>

            <div class="site-description">
                <h3><i class="fas fa-satellite-dish"></i>تابعنا وكن على اطلاع:</h3>
                <ul>
                    <li><a href="https://youtube.com/@mohtaref_ps2?si=0z4x36S8ylMKzEDc" target="_blank" rel="noopener noreferrer"><i class="fab fa-youtube"></i>اشترك الان في قناة اليوتيوب ❤️</a></li> 
                    <li>انضم معنا في:
                        <ul>
                            <li>1-<a href="https://t.me/mohtaref_ps2_1" target="_blank" rel="noopener noreferrer"><i class="fab fa-telegram"></i>قناة التيليكرام</a></li> 
                            <li>2-<a href="https://t.me/mohtaref_ps2_3/788" target="_blank" rel="noopener noreferrer"><i class="fas fa-users"></i>⁦منتدى المتابعين للحل السريع</a></li> 
                            <li>3-<a href="https://t.me/mohtaref_ps2_3" target="_blank" rel="noopener noreferrer"><i class="fas fa-comments"></i>مجموعة الموضوعات</a></li> 
                            <li>4-<a href="https://t.me/mohtaref_ps2_3" target="_blank" rel="noopener noreferrer"><i class="fab fa-tiktok"></i>قناة التيك توك</a></li> 
                        </ul>
                    </li>
                </ul>
            </div>

            <div id="search-area">
                <input type="text" id="gameIdInput" placeholder="أدخل ID اللعبة (مثال: SLUS_203.15)"> 
                <button onclick="searchArchives()"><i class="fas fa-search"></i>بحث</button>
            </div>
            <div id="status-messages">
                <p id="message-area" class="loading" style="display:none;"></p>
            </div>
            <div id="results" class="results-area"></div>
            
            <button class="nav-button" onclick="showChanger()"><i class="fas fa-edit"></i>الانتقال إلى واجهة تعديل الأيدي</button>
        </div>

        <div class="interface-section" id="changer-interface" style="display:none;">
            <h3><i class="fas fa-edit"></i>واجهة تغيير ايدي الصور</h3>
            <p>تقوم هذه الواجهة بسحب ملف صور بناءً على الأيدي الأصلي، وتغيير أسماء كل الصور بداخله إلى الأيدي الجديد، ثم تتيح لك تحميل الملف المعدل.</p>
            <div class="id-changer-area">
                <div>
                    <label for="originalIdInput">1. الأيدي الأصلي للملف (الذي تريد سحبه):</label>
                    <input type="text" id="originalIdInput" placeholder="مثال: SLES_556.22">
                </div>
                <div>
                    <label for="newIdInput">2. الأيدي الجديد المطلوب (الذي تريد تطبيقه):</label>
                    <input type="text" id="newIdInput" placeholder="مثال: SLUS_203.15">
                </div>
            </div>
            <button onclick="renameAndPackage()"><i class="fas fa-sync-alt"></i>تغيير وتحميل</button>
            <div id="id-changer-status">
                <p id="id-changer-message" class="loading" style="display:none;"></p>
            </div>
            <div id="id-changer-results" class="results-area"></div>

            <button class="nav-button" onclick="showSearch()"><i class="fas fa-search"></i>العودة إلى واجهة البحث</button>
        </div>
        
    </div>

    <script>
        // --- DOM Elements ---
        const searchInterface = document.getElementById('search-interface');
        const changerInterface = document.getElementById('changer-interface');

        const gameIdInput = document.getElementById('gameIdInput'); 
        const resultsDiv = document.getElementById('results'); 
        const messageArea = document.getElementById('message-area'); 
        
        // --- Global Variables ---
        let allGameArchives = []; 
        const zipArchivesBaseUrl = './ps2_covers/'; 

        // --- Functions to switch between interfaces ---
        function showSearch() {
            searchInterface.style.display = 'block';
            changerInterface.style.display = 'none';
        }

        function showChanger() {
            searchInterface.style.display = 'none';
            changerInterface.style.display = 'block';
        }

        // --- Generic Message Function ---
        function showMessage(message, type, elementId) {
            const el = document.getElementById(elementId);
            if (el) {
                el.textContent = message; 
                el.className = `status-message ${type}`; 
                el.style.display = message ? 'block' : 'none'; 
            }
        }

        // --- On Page Load ---
        window.onload = async function() {
            showMessage('جاري تحميل قائمة الأرشيفات...', 'loading', 'message-area'); 
            try {
                const response = await fetch('./ps2_covers.json'); 
                if (!response.ok) { 
                    throw new Error(`خطأ في تحميل ملف JSON: ${response.status} ${response.statusText}`); 
                }
                allGameArchives = await response.json(); 
                showMessage('تم تحميل قائمة الأرشيفات بنجاح. جاهز للبحث.', 'success', 'message-area'); 
            } catch (error) {
                console.error("خطأ في تحميل أو تحليل ملف JSON:", error); 
                showMessage(`فشل تحميل قائمة الأرشيفات. تأكد من تشغيل خادم بايثون وأن الملف موجود. الخطأ: ${error.message}`, 'error', 'message-area'); 
            }
        };

        // --- Search Logic ---
        function searchArchives() {
            const gameId = gameIdInput.value.trim().toUpperCase(); 
            resultsDiv.innerHTML = ''; 
            if (!gameId) {
                showMessage('الرجاء إدخال معرف اللعبة للبحث.', 'error', 'message-area'); 
                return;
            }
            const foundArchives = allGameArchives.filter(archiveEntry => 
                archiveEntry.id.toUpperCase().startsWith(gameId)
            );
            if (foundArchives.length > 0) {
                showMessage(`تم العثور على ${foundArchives.length} أرشيف/أرشيفات مطابقة:`, 'info', 'message-area'); 
                foundArchives.forEach(archiveEntry => {
                    const link = document.createElement('a');
                    link.href = `${zipArchivesBaseUrl}${archiveEntry.archiveFile}`; 
                    link.download = archiveEntry.archiveFile; 
                    link.innerHTML = `<i class="fas fa-download"></i>تحميل ${archiveEntry.archiveFile}`; 
                    link.className = 'download-link'; 
                    resultsDiv.appendChild(link);
                });
            } else {
                showMessage('لم يتم العثور على أرشيفات صور تطابق هذا المعرف.', 'info', 'message-area'); 
            }
        }
        
        gameIdInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                searchArchives();
            }
        });

        // --- ID Changer Logic ---
        async function renameAndPackage() {
            const originalIdInput = document.getElementById('originalIdInput');
            const newIdInput = document.getElementById('newIdInput');
            const changerResultsDiv = document.getElementById('id-changer-results');

            const originalId = originalIdInput.value.trim();
            const newId = newIdInput.value.trim();
            
            changerResultsDiv.innerHTML = '';

            if (!originalId || !newId) {
                showMessage('الرجاء إدخال الأيدي الأصلي والجديد.', 'error', 'id-changer-message');
                return;
            }

            showMessage('جاري تعديل الملف... قد تستغرق هذه العملية بضع ثوانٍ.', 'loading', 'id-changer-message');

            try {
                const response = await fetch('/rename-and-zip', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ original_id: originalId, new_id: newId })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showMessage('تم إنشاء الملف المعدل بنجاح! جاهز للتحميل.', 'success', 'id-changer-message');
                    const link = document.createElement('a');
                    link.href = data.download_url;
                    link.innerHTML = `<i class="fas fa-download"></i>تحميل الملف الجديد (${data.filename})`;
                    link.className = 'download-link';
                    changerResultsDiv.appendChild(link);
                } else {
                    throw new Error(data.error || 'حدث خطأ غير معروف في الخادم.');
                }
            } catch (error) {
                console.error("Error during rename and package:", error);
                showMessage(`فشل: ${error.message}`, 'error', 'id-changer-message');
            }
        }
    </script>
</body>
</html>
